#!/usr/bin/env ruby

lib = File.expand_path('../../lib', __FILE__)
$LOAD_PATH.unshift(lib) unless $LOAD_PATH.include?(lib)

require 'trollop'
require 'swm'

def run
  options = get_options
  begin
    Swm::CommandRunner.run options[:command], options[:command_options], options[:global_options]
  rescue Exception => ex
    puts ex.message
    exit(1)
  end
end

def get_options
  global_options = Trollop::options do
    banner "utility that can move and resize windows"
    stop_on %w[ move resize ]
  end
  { global_options: global_options }.merge get_command
end

def get_command
  command = ARGV.shift
  Trollop.die "no command" unless command
  command = command.to_sym
  { command: command }.merge get_command_options(command)
end

def get_command_options(command)
  {
    command_options: case command
    when :move
      get_move_options
    when :resize
      get_resize_options
    else
      Trollop::die "unknown command #{command.to_s}"
    end
  }
end

def get_move_options
  Trollop::options do
    opt :x, "The placement on the x-axis: left, middle, right, or 0%-100%", type: String
    opt :y, "The placement on the y-axis: top, middle, bottom, or 0%-100%", type: String
  end
end

def get_resize_options
  Trollop::options do
    opt :width, "The width in pixels", type: Integer
    opt :height, "The height in pixels", type: Integer
  end
end

run
